<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Week</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="The week schedule">

    <!-- Le styles -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/bootstrap-responsive.css" rel="stylesheet">
    <link href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png">
    <link rel="shortcut icon" href="ico/favicon.png">
    <!-- CUSTOM CSS -->
    <style>
    /* Day Select */
    #prev-day:hover, #prev-day:focus, #next-day:hover, #next-day:focus {
      color: rgb(0, 85, 128);
      text-decoration: none;
    }
    #prev-day, #next-day {
      color: rgb(0, 136, 204);
      padding:3px;
    }
    #day > h3 {
      text-align: center;
    }
    /* Times of Day Div Styling */
    #day > div {
      border: 1px solid rgba(51, 51, 51, 0.15);
      float: left;
      margin-bottom: 10px;
    }
    #day > div:hover, #day > div:focus {
      border: 1px solid rgb(0, 85, 128);
    }
    #day > div > h4 {
      margin-left: 1em;
    }
    #day > div > h4 > img {
      width: 20px;
      height: 20px;
      float: right;
      margin-right: 1em;
    }
    #day > div > h4 > img:hover,  #day > div > h4 > img:focus {
      background-color: rgba(0,0,0, 0.8);
    }
    .droppable {
      min-height: 125px;
    }
    #day > #day-footer {
      border: 0px;
      text-align: center;
      float: none;
      clear: both;
    }


    /* Employee List Styling */
    .employees {
      min-width: 150px;
    }
    .employees > h4 > a:hover, .employees > h4 > a:focus {
      text-decoration: none;
    }
    .horizontal-grey-line {
      background-color: rgba(51, 51, 51, 0.3);
      height: 1px;
      margin: 8px 0;
    }
    .employees > ul, .dropped-list  {
      list-style-type: none;
      padding: 0;
      margin-left: 0;
    }
    .employees > ul > li, .dropped-list > li {
      background-color: rgb(12, 40, 73);
      color: rgb(237, 239, 242);
      font-size: 1.2em;
      padding: 8px 0;
      margin-bottom: 4px;
      text-align: center;
      min-width: 150px;
    }
    /* Employee list special to scheduled employees */
    .dropped-list {
      padding-bottom: 30px;
    }
    .dropped-list > li > span {
      float: left;
      margin-left: 1em;
      margin-right: -1em;
      vertical-align: middle;
      cursor: pointer;
      font-weight: bold;
      color: rgb(0, 136, 204);
      font-size: 1.25em;
      margin-top: -2px;
    }
    .dropped-list > li > span:hover, .dropped-list > li > span:focus {
      color: rgb(0, 85, 128);
      cursor: pointer;
    }
    </style>
    <body>
    <div class="container">
      <!-- Calendar -->
      <div class="row">
        
      </div>
      <!-- Main UI -->
      <div class="row">
        <div class="span2 employees">
          <h4>Employees <a href="#add-employee">+</a></h4>
          <div class="horizontal-grey-line"></div>
          <ul id="employee-list">
            <li>Colin Bookman</li>
            <li>Bob Dylan</li>
            <li>James Tight</li>
          </ul>
        </div>
        <div id="day" class="offset2">
          <h3>
            <a href="#prev-day" id="prev-day">&lt;</a>
            1/1/2013 
            <a id="next-day" href="#next-day">&gt;</a>
          </h3>
          <!-- Time Slots -->
          <div id="morning" class="span3 droppable">
            <h4>Morning <img onclick="settings('morning');" src="img/blue-cog.png"></img></h4> 
            <ul class="dropped-list"></ul>
          </div>
          <div id="afternoon" class="span3 droppable">
            <h4>Afternoon <img onclick="settings('afternoon');" src="img/blue-cog.png"></img></h4> 
            <ul class="dropped-list"></ul>
          </div>
          <div id="evening" class="span3 droppable">
            <h4>Evening <img onclick="settings('evening');" src="img/blue-cog.png"></img></h4> 
            <ul class="dropped-list"></ul>
          </div>
          <!-- End Time Slots -->
          <div id="day-footer">
            <button class="btn btn-primary">Add New Timeslot</button>
          </div>
        </div>
      </div>
    </div>
     <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script>
    var scheduled = {};
    function updateRegions(name, location) {
      //Make sure scheduled has each region in it
      var all_locations = document.getElementsByClassName('droppable');
      for(var i = 0; i<all_locations.length; i++) {
        if(scheduled[all_locations[i].id] == undefined) {
          //Add location as not already declared
          scheduled[all_locations[i].id] = [];
        }
      }
      //Check if employee is in region true -> add, false --> return false
      if(scheduled[location].indexOf(name) < 0) {
        scheduled[location].push(name);
        return true;
      } else {
        return false;
      }
    }
    function deleteItem(name, location) {
      var parentUL = document.getElementById(location).getElementsByClassName('dropped-list')[0];
      var scheduled_staff = parentUL.getElementsByTagName('li');
      for(var i = 0; i< scheduled_staff.length; i++) {
        if(scheduled_staff[i].textContent.substring(1) == name) {
          parentUL.removeChild(scheduled_staff[i]);
          scheduled[location].pop(name);
        }
      }
    }
    function settings(location) {
      alert("Not implemented, Received you want to get settings for: " + location);
    }
    $(function() {
      //Drag Employees
      var $employees = $("#employee-list");
      $("li", $employees).draggable({
        revert: "invalid",
        containment: "document",
        // appendTo: "body",
        helper: "clone",
        cursor: "move",
        cursorAt: { left: -8 }
      });
      //Drop in the .droppable classes
      $(".droppable").droppable({
        drop: function(event, ui) {
          var name = ui.draggable.text();
          var time = this.id;
          if(updateRegions(name, time)) { //Dont add if user already exists
            var elementHTML = '<li><span onclick="deleteItem(\'' + name + '\', \''+ time + '\');">x</span>'+name+'</li>';
            this.getElementsByTagName("ul")[0].innerHTML+= elementHTML;
          } else {
            //Shake div
             $( "#"+time ).effect( "shake" );
          }
        }
      })

    });
    </script>
    </body>
</html>
